FROM alpine:latest
LABEL maintainer="Salvatore Francesco Indino"

# Installazione dipendenze per Nebula
RUN apk update && apk upgrade && \
    apk add --no-cache bash git make cmake gcc musl-dev openssl-dev

RUN apk add --no-cache go

    
# Copia dei file di configurazione necessari a nebula
WORKDIR /nebula

#COPY /home/salvatore/Scrivania/nebula_docker/ca.key  /nebula
#COPY /home/salvatore/Scrivania/nebula_docker/ca.crt /nebula
#COPY /home/salvatore/Scrivania/nebula_docker/host.crt /nebula
#COPY /home/salvatore/Scrivania/nebula_docker/host.key /nebula
#COPY /home/salvatore/Scrivania/nebula_docker/config.yaml /nebula

COPY ./ca.key  /nebula/
COPY ./ca.crt /nebula/
COPY ./host.crt /nebula/
COPY ./host.key /nebula/
COPY ./config.yaml /nebula/
COPY ./nebula /nebula/

# Clonazione e compilazione di Nebula
#RUN git clone https://github.com/slackhq/nebula.git && \
 #   cd nebula && \
  #  make -j $(nproc)

RUN ifconfig

# Esposizione delle porte utilizzate da Nebula
EXPOSE 4242/tcp
EXPOSE 4242/udp

EXPOSE 4241/tcp
EXPOSE 4241/udp



# Install sudo package
RUN apk add --no-cache sudo

#----------------------------

#----------------------------




# Impostazione del comando predefinito per avviare Nebula
CMD ["./nebula", "-config", "/nebula/config.yaml"]

